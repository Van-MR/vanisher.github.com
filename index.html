<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hands">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/icon.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/icon.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="需要努力去超越的唯有昨日的自己">
<meta property="og:type" content="website">
<meta property="og:title" content="Vanisher&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Vanisher&#39;s Blog">
<meta property="og:description" content="需要努力去超越的唯有昨日的自己">
<meta property="og:locale" content="zh-Hands">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Vanisher&#39;s Blog">
<meta name="twitter:description" content="需要努力去超越的唯有昨日的自己">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>Vanisher's Blog</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hands">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Vanisher's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/07/NodeJS + Express + Mongo 构建API/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="vanisher">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/19483268?s=400&u=97869a443baab2820618a8a575cee677b80849c7&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vanisher's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/07/NodeJS + Express + Mongo 构建API/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-07T10:58:12+08:00">
                2019-03-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://cdn-images-1.medium.com/max/800/1*s5LVdcugM62xzSvGUpTLWA.png" alt="Node"></p>
<p>首先选择一个目录执行npm init指令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm init</span><br></pre></td></tr></table></figure></p>
<p>我们要使用Express作为我们的框架,MongoDB作为数据库,并且需要body-parser这个包帮助我们处理JSON请求<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save express mongodb@2.2.16 body-parser</span><br></pre></td></tr></table></figure></p>
<p>我强烈推荐使用 Nodemon作为我们的开发依赖,它是一个非常简单的包能够自动重启我们的服务当文件发生变化时。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev nodemon</span><br></pre></td></tr></table></figure></p>
<p>同时在我们的package.json文件中,来修改我们的启动指令<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//package.json</span></span><br><span class="line"><span class="string">"script"</span>: &#123;</span><br><span class="line"><span class="string">"dev"</span>: <span class="string">"nodemon server.js"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们的package.json文件最终应该是这样<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//package.json</span></span><br><span class="line">  &#123;</span><br><span class="line">   <span class="string">"name"</span>: <span class="string">"notable"</span>,</span><br><span class="line">   <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">   <span class="string">"description"</span>: <span class="string">""</span>,</span><br><span class="line">   <span class="string">"main"</span>: <span class="string">"server.js"</span>,</span><br><span class="line">   <span class="string">"scripts"</span>: &#123;</span><br><span class="line">     <span class="string">"dev"</span>: <span class="string">"nodemon server.js"</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="string">"author"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line"> <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">   <span class="string">"body-parser"</span>: <span class="string">"^1.15.2"</span>,</span><br><span class="line">   <span class="string">"express"</span>: <span class="string">"^4.14.0"</span>,</span><br><span class="line">   <span class="string">"mongodb"</span>: <span class="string">"^2.2.16"</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">   <span class="string">"nodemon"</span>: <span class="string">"^1.11.0"</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在我们可以创建server.js来开始构建我们的API</p>
<h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><p>我们开始引入所有的依赖在server.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express  = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> MongoClient = <span class="built_in">require</span>(<span class="string">'mongodb'</span>).MongoClient;</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br></pre></td></tr></table></figure></p>
<p>您将使用MongoClient与数据库进行交互。请注意，您还将应用程序初始化为Express框架的实例。</p>
<p>让服务器启动并运行所需要做的最后一件事是告诉您的应用程序开始侦听 HTTP请求。</p>
<p>您可以指定一个端口，并像这样开始监听：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8000</span>;</span><br><span class="line">app.listen（port，（）=&gt; &#123;</span><br><span class="line"> <span class="built_in">console</span>.log（<span class="string">'we are running at'</span>+port）;</span><br><span class="line">&#125;）;</span><br></pre></td></tr></table></figure></p>
<h3 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h3><p>执行CRUD操作我们需要创建4个routes去处理相应的CREATE,READ,UPDATE,DELETE</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$  mkdir app</span><br><span class="line">$  <span class="built_in">cd</span> app</span><br><span class="line">$  mkdir routes</span><br><span class="line">$  <span class="built_in">cd</span> routes</span><br><span class="line">$  touch index.js</span><br><span class="line">$  touch note_routes.js</span><br></pre></td></tr></table></figure>
<p>在我们进行这些操作前我们需要做一些基础的准备工作,封装一个一个简单的函数,用来将我们的Express和routes包裹在里面,并将这个函数对外暴露出去方便在其他模块中require<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/note_routes.js</span></span><br><span class="line"> <span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app, db</span>) </span>&#123;</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/index.js</span></span><br><span class="line">   <span class="keyword">const</span> noteRoutes = <span class="built_in">require</span>(<span class="string">'./note_routes'</span>);</span><br><span class="line">   <span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app, db</span>) </span>&#123;</span><br><span class="line">     noteRoutes(app, db);</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure>
<p>接下来在server.js文件中引入<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"> <span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"> <span class="keyword">const</span> MongoClient = <span class="built_in">require</span>(<span class="string">'mongodb'</span>).MongoClient;</span><br><span class="line"> <span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"> <span class="keyword">const</span> app = express();</span><br><span class="line"> <span class="keyword">const</span> port = <span class="number">8000</span>;</span><br><span class="line"> <span class="built_in">require</span>(<span class="string">'./app/routes'</span>)(app, &#123;&#125;);</span><br><span class="line"> app.listen(port, () =&gt; &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'We are live on '</span> + port);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></p>
<p>现在来简单的测试一下CREATE 操作<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// note_routes.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app, db</span>) </span>&#123;</span><br><span class="line"> app.post(<span class="string">'/notes'</span>, (req, res) =&gt; &#123;</span><br><span class="line">   <span class="comment">// You'll create your note here.</span></span><br><span class="line">   res.send(<span class="string">'Hello'</span>)</span><br><span class="line"> &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>等我们的app接收到post请求的并且请求url是/notes,它会执行上面代码的回调函数返回客户端”Hello”</p>
<p>我们可以拿Postman测试去发送一个post请求</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*pqIRP6BQSrVCCc6XVPZxPg.png" alt="postman"></p>
<p>接下来我们在请求中添加一些参数并且在后台获取请求参数,人后写入我们的数据库</p>
<p>先建立一个数据库的配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir config</span><br><span class="line">$ <span class="built_in">cd</span> config</span><br><span class="line">$ touch db.js</span><br></pre></td></tr></table></figure></p>
<p>在里面加入配置信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  module.exports = &#123;</span><br><span class="line">  url : 你的 URL</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>填完配置信息后,在我们的server.js中连接数据库操作<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> express        = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> MongoClient    = <span class="built_in">require</span>(<span class="string">'mongodb'</span>).MongoClient;</span><br><span class="line"><span class="keyword">const</span> bodyParser     = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> db             = <span class="built_in">require</span>(<span class="string">'./config/db'</span>);</span><br><span class="line"><span class="keyword">const</span> app            = express();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8000</span>;</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">MongoClient.connect(db.url, (err, database) =&gt; &#123;</span><br><span class="line"> <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err)</span><br><span class="line"> <span class="built_in">require</span>(<span class="string">'./app/routes'</span>)(app, database);</span><br><span class="line"> app.listen(port, () =&gt; &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'We are live on '</span> + port);</span><br><span class="line"> &#125;);               </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>在我们的note_routes.js来进行相关的insert操作<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// note_routes.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app, db</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">const</span> collection =</span><br><span class="line"> app.post(<span class="string">'/notes'</span>, (req, res) =&gt; &#123;</span><br><span class="line">   <span class="keyword">const</span> note = &#123; <span class="attr">text</span>: req.body.body, <span class="attr">title</span>: req.body.title &#125;;</span><br><span class="line">   db.collection(<span class="string">'notes'</span>).insert(note, (err, result) =&gt; &#123;</span><br><span class="line">     <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       res.send(&#123; <span class="string">'error'</span>: <span class="string">'An error has occurred'</span> &#125;);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       res.send(result.ops[<span class="number">0</span>]);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>post请求成功时我们打印出新添加的那条数据,同样的我们用postman来测试一下</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*YcGwoqOpRkQEo-N0W_-WEA.png" alt="insert"></p>
<p>接下来再来试一下get请求<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// note_routes.js</span></span><br><span class="line"><span class="keyword">var</span> ObjectID = <span class="built_in">require</span>(<span class="string">'mongodb'</span>).ObjectID;</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app, db</span>) </span>&#123;</span><br><span class="line"> app.get(<span class="string">'/notes/:id'</span>, (req, res) =&gt; &#123;</span><br><span class="line">   <span class="keyword">const</span> id = req.params.id;</span><br><span class="line">   <span class="keyword">const</span> details = &#123; <span class="string">'_id'</span>: <span class="keyword">new</span> ObjectID(id) &#125;;</span><br><span class="line">   db.collection(<span class="string">'notes'</span>).findOne(details, (err, item) =&gt; &#123;</span><br><span class="line">     <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       res.send(&#123;<span class="string">'error'</span>:<span class="string">'An error has occurred'</span>&#125;);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       res.send(item);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;);</span><br><span class="line">app.post(<span class="string">'/notes'</span>, (req, res) =&gt; &#123;</span><br><span class="line">   <span class="keyword">const</span> note = &#123; <span class="attr">text</span>: req.body.body, <span class="attr">title</span>: req.body.title &#125;;</span><br><span class="line">   db.collection(<span class="string">'notes'</span>).insert(note, (err, result) =&gt; &#123;</span><br><span class="line">     <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       res.send(&#123; <span class="string">'error'</span>: <span class="string">'An error has occurred'</span> &#125;);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       res.send(result.ops[<span class="number">0</span>]);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*C18DVEZFNx6MCQby_VtWKg.png" alt="get"></p>
<p>Delete 操作<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// note_routes.js</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">app.delete(<span class="string">'/notes/:id'</span>, (req, res) =&gt; &#123;</span><br><span class="line"> <span class="keyword">const</span> id = req.params.id;</span><br><span class="line"> <span class="keyword">const</span> details = &#123; <span class="string">'_id'</span>: <span class="keyword">new</span> ObjectID(id) &#125;;</span><br><span class="line"> db.collection(<span class="string">'notes'</span>).remove(details, (err, item) =&gt; &#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">     res.send(&#123;<span class="string">'error'</span>:<span class="string">'An error has occurred'</span>&#125;);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     res.send(<span class="string">'Note '</span> + id + <span class="string">' deleted!'</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure></p>
<p>Put 操作<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// note_routes.js</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">app.put(<span class="string">'/notes/:id'</span>, (req, res) =&gt; &#123;</span><br><span class="line"> <span class="keyword">const</span> id = req.params.id;</span><br><span class="line"> <span class="keyword">const</span> details = &#123; <span class="string">'_id'</span>: <span class="keyword">new</span> ObjectID(id) &#125;;</span><br><span class="line"> <span class="keyword">const</span> note = &#123; <span class="attr">text</span>: req.body.body, <span class="attr">title</span>: req.body.title &#125;;</span><br><span class="line"> db.collection(<span class="string">'notes'</span>).update(details, note, (err, result) =&gt; &#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       res.send(&#123;<span class="string">'error'</span>:<span class="string">'An error has occurred'</span>&#125;);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       res.send(note);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*LZ1DzuxzAJAyNYjO4sZcmg.png" alt="put"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/01/D3画一个饼图/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="vanisher">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/19483268?s=400&u=97869a443baab2820618a8a575cee677b80849c7&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vanisher's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/01/D3画一个饼图/" itemprop="url">D3学习之路 画一个饼图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-01T18:15:48+08:00">
                2019-02-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> donutData = [</span><br><span class="line">         &#123;<span class="attr">name</span>: <span class="string">"Antelope"</span>,<span class="attr">value</span>: <span class="number">15</span>&#125;,</span><br><span class="line">         &#123;<span class="attr">name</span>: <span class="string">"Bear"</span>,<span class="attr">value</span>: <span class="number">9</span>&#125;,</span><br><span class="line">         &#123;<span class="attr">name</span>: <span class="string">"Cheetah"</span>,<span class="attr">value</span>: <span class="number">19</span>&#125;,</span><br><span class="line">         &#123;<span class="attr">name</span>: <span class="string">"Dolphin"</span>,<span class="attr">value</span>: <span class="number">12</span>&#125;,</span><br><span class="line">         &#123;<span class="attr">name</span>: <span class="string">"Elephant"</span>,<span class="attr">value</span>: <span class="number">14</span>&#125;,</span><br><span class="line">         &#123;<span class="attr">name</span>: <span class="string">"Flamingo"</span>,<span class="attr">value</span>: <span class="number">21</span>&#125;,</span><br><span class="line">         &#123;<span class="attr">name</span>: <span class="string">"Giraffe"</span>,<span class="attr">value</span>: <span class="number">18</span>&#125;,</span><br><span class="line">         &#123;<span class="attr">name</span>: <span class="string">"Other"</span>,<span class="attr">value</span>: <span class="number">8</span>&#125;</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> screenWidth = <span class="built_in">window</span>.innerWidth;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> margin = &#123;<span class="attr">left</span>: <span class="number">20</span>, <span class="attr">top</span>: <span class="number">20</span>, <span class="attr">right</span>: <span class="number">20</span>, <span class="attr">bottom</span>: <span class="number">20</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> width = <span class="built_in">Math</span>.min(screenWidth, <span class="number">500</span>) - margin.left - margin.right;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> height = <span class="built_in">Math</span>.min(screenWidth, <span class="number">500</span>) - margin.top - margin.bottom;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> svg = d3.select(<span class="string">"#chart"</span>)</span><br><span class="line">              .append(<span class="string">"svg"</span>)</span><br><span class="line">              .attr(<span class="string">"width"</span>,(width + margin.left + margin.right))</span><br><span class="line">              .attr(<span class="string">"height"</span>,(height + margin.top + margin.bottom))</span><br><span class="line">              .append(<span class="string">"g"</span>)</span><br><span class="line">              .attr(<span class="string">"class"</span>,<span class="string">"wrapped"</span>)</span><br><span class="line">              .attr(<span class="string">"transform"</span>,<span class="string">`translate(<span class="subst">$&#123;width<span class="regexp">/2 + margin.left&#125;,$&#123;height/</span><span class="number">2</span> + margin.top&#125;</span>)`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> colorScale = d3.scale.linear()</span><br><span class="line">          .domain([<span class="number">1</span>,<span class="number">3.5</span>,<span class="number">6</span>])</span><br><span class="line">          .range([<span class="string">"#2c7bb6"</span>, <span class="string">"#ffffbf"</span>, <span class="string">"#d7191c"</span>])</span><br><span class="line">          .interpolate(d3.interpolateHcl);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> arc =  d3.svg.arc()</span><br><span class="line">        .innerRadius(width*<span class="number">0.75</span>/<span class="number">2</span>)</span><br><span class="line">        .outerRadius(width*<span class="number">0.75</span>/<span class="number">2</span> + <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> pie = d3.layout.pie()</span><br><span class="line">            .startAngle(<span class="number">-90</span> * <span class="built_in">Math</span>.PI/<span class="number">180</span>)</span><br><span class="line">            .endAngle(<span class="number">-90</span> * <span class="built_in">Math</span>.PI/<span class="number">180</span> + <span class="number">2</span>*<span class="built_in">Math</span>.PI)</span><br><span class="line">            .value(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.value; &#125;)</span><br><span class="line">            .padAngle(<span class="number">.01</span>)</span><br><span class="line">            .sort(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  svg.selectAll(<span class="string">'.donutArcSlices'</span>)</span><br><span class="line">      .data(pie(donutData))</span><br><span class="line">      .enter()</span><br><span class="line">      .append(<span class="string">"path"</span>)</span><br><span class="line">      .attr(<span class="string">"class"</span>,<span class="string">"donutArcSlices"</span>)</span><br><span class="line">      .attr(<span class="string">"id"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d,i</span>) </span>&#123; <span class="keyword">return</span> <span class="string">"donutArc"</span>+i; &#125; )</span><br><span class="line">      .attr(<span class="string">"d"</span>,arc)</span><br><span class="line">      .attr(<span class="string">"fill"</span>, (d,i) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(i === <span class="number">7</span>) <span class="keyword">return</span> <span class="string">"#CCCCCC"</span>; <span class="comment">//Other</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> colorScale(i);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">svg.selectAll(<span class="string">".donutText"</span>)</span><br><span class="line">    .data(donutData)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"donutText"</span>)</span><br><span class="line">    .attr(<span class="string">"dy"</span>, <span class="number">-13</span>)</span><br><span class="line">    .append(<span class="string">"textPath"</span>)</span><br><span class="line">    .attr(<span class="string">"xlink:href"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">d,i</span>)</span>&#123;<span class="keyword">return</span> <span class="string">"#donutArc"</span>+i;&#125;)</span><br><span class="line">    .text(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>)</span>&#123;<span class="keyword">return</span> d.name;&#125;);</span><br></pre></td></tr></table></figure>
<p>最终效果图如下<br><img src="/2019/02/01/D3画一个饼图/pie.png" alt="饼图"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/01/D3画一个柱状图/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="vanisher">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/19483268?s=400&u=97869a443baab2820618a8a575cee677b80849c7&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vanisher's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/01/D3画一个柱状图/" itemprop="url">D3学习之路  画一个不同颜色的柱状图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-01T18:04:50+08:00">
                2019-02-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>第一步  引入d3文件<br>       创建一个容器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">&lt;style type=<span class="string">"text/css"</span>&gt;</span><br><span class="line"> body &#123;font-family: calibri;margin:<span class="number">0</span>;&#125;</span><br><span class="line"> .axis &#123;<span class="attr">font</span>: <span class="number">14</span>px calibri;&#125;</span><br><span class="line"> .label &#123;<span class="attr">font</span>: <span class="number">16</span>px calibri;&#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">&lt;title&gt;Document&lt;/</span>title&gt;</span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">  &lt;p&gt;Frequency of usage of letters in English&lt;/</span>p&gt;</span><br><span class="line">  &lt;h2&gt;Bar Chart <span class="number">1</span>&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div&gt;&lt;svg id="chart1" width="800" height="400"&gt;&lt;/</span>svg&gt;&lt;/div&gt;</span><br><span class="line">  &lt;script src=<span class="string">"https://d3js.org/d3.v4.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script src=<span class="string">"https://d3js.org/d3-scale-chromatic.v1.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">  &lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>
<p>这里我使用的d3版本是v4</p>
<p>第二步  模拟data数据<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"A"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".08167"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"B"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".01492"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"C"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".02782"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"D"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".04253"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"E"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".12702"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"F"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".02288"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"G"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".02015"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"H"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".06094"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"I"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".06966"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"J"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".00153"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"K"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".00772"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"L"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".04025"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"M"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".02406"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"N"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".06749"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"O"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".07507"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"P"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".01929"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"Q"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".00095"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"R"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".05987"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"S"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".06327"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"T"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".09056"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"U"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".02758"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"V"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".00978"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"W"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".02360"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"X"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".00150"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"Y"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".01974"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"letter"</span>: <span class="string">"Z"</span>,</span><br><span class="line">            <span class="string">"frequency"</span>: <span class="string">".00074"</span></span><br><span class="line">          &#125;</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure></p>
<p>第三步  选择容器,开始设置容器的样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//chart</span></span><br><span class="line">   <span class="keyword">var</span> svg1 =d3.select(<span class="string">"#chart1"</span>);</span><br><span class="line">   <span class="keyword">var</span> margin = &#123;<span class="attr">top</span>:<span class="number">20</span>,<span class="attr">right</span>:<span class="number">20</span>,<span class="attr">bottom</span>:<span class="number">30</span>,<span class="attr">left</span>:<span class="number">40</span>&#125;,</span><br><span class="line">       width  = +svg1.attr(<span class="string">"width"</span>) - margin.left - margin.right,</span><br><span class="line">       height = +svg1.attr(<span class="string">"height"</span>) - margin.top - margin.bottom;</span><br></pre></td></tr></table></figure>
<p>第四步  创建比例尺(颜色,x y 轴)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建颜色比例尺</span></span><br><span class="line"><span class="keyword">var</span> colorScale_1 = d3.scaleSequential(d3.interpolateRainbow);</span><br><span class="line">    colorScale_1.domain([<span class="number">0</span>,<span class="number">25</span>]);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//创建x,y 轴比例尺</span></span><br><span class="line"><span class="keyword">var</span> x1 = d3.scaleBand().rangeRound([<span class="number">0</span>, width]).domain(data.map(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.letter; &#125;)).padding(<span class="number">0.2</span>),</span><br><span class="line">    y1 = d3.scaleLinear().rangeRound([height, <span class="number">0</span>]).domain([<span class="number">0</span>,d3.max(data,<span class="function"><span class="keyword">function</span>(<span class="params">d</span>)</span>&#123; <span class="keyword">return</span> d.frequency;&#125;)]);</span><br></pre></td></tr></table></figure>
<p>第五步 创建 X,Y 坐标轴</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> g1 = svg1.append(<span class="string">"g"</span>)</span><br><span class="line">       .attr(<span class="string">"transform"</span>,<span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>,<span class="subst">$&#123;margin.top&#125;</span>)`</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//xAxis</span></span><br><span class="line">   g1.append(<span class="string">"g"</span>)</span><br><span class="line">      .attr(<span class="string">"class"</span>,<span class="string">"axis x-aixs"</span>)</span><br><span class="line">      .attr(<span class="string">"transform"</span>,<span class="string">`translate(0,<span class="subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">      .call(d3.axisBottom(x1));</span><br><span class="line"></span><br><span class="line">   <span class="comment">//yAxis</span></span><br><span class="line">   g1.append(<span class="string">"g"</span>)</span><br><span class="line">     .attr(<span class="string">"class"</span>, <span class="string">"axis y-axis"</span>)</span><br><span class="line">     .call(d3.axisLeft(y1).ticks(<span class="number">10</span>, <span class="string">"#"</span>));</span><br></pre></td></tr></table></figure>
<p>给 Y轴添加标签<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">g1.append(<span class="string">"text"</span>)</span><br><span class="line">        .attr(<span class="string">"class"</span>,<span class="string">"label"</span>)</span><br><span class="line">        .attr(<span class="string">"x"</span>,<span class="number">0</span>-margin.left)</span><br><span class="line">        .attr(<span class="string">"y"</span>,<span class="number">-10</span>)</span><br><span class="line">        .style(<span class="string">"text-anchor"</span>,<span class="string">"start"</span>)</span><br><span class="line">        .text(<span class="string">"Frequency"</span>);</span><br></pre></td></tr></table></figure></p>
<p>最后 通过data数据生成柱状图<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">g1.selectAll(<span class="string">".bar"</span>)</span><br><span class="line">       .data(data)</span><br><span class="line">       .enter()</span><br><span class="line">       .append(<span class="string">"rect"</span>)</span><br><span class="line">       .attr(<span class="string">"class"</span>,<span class="string">"bar"</span>)</span><br><span class="line">       .attr(<span class="string">"x"</span>, d =&gt; x1(d.letter))</span><br><span class="line">       .attr(<span class="string">"y"</span>, d =&gt; y1(d.frequency))</span><br><span class="line">       .attr(<span class="string">"width"</span>, x1.bandwidth()) <span class="comment">// 每条柱子的宽度</span></span><br><span class="line">       .attr(<span class="string">"height"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> height - y1(d.frequency); &#125;)</span><br><span class="line">       .style(<span class="string">"fill"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d,i</span>)</span>&#123; <span class="keyword">return</span> colorScale_1(i)&#125;);  <span class="comment">// 每个柱状图的颜色</span></span><br></pre></td></tr></table></figure></p>
<p>最终实现效果图</p>
<p><img src="/2019/02/01/D3画一个柱状图/bar.png" alt="柱状图"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/01/copy/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="vanisher">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/19483268?s=400&u=97869a443baab2820618a8a575cee677b80849c7&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vanisher's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/01/copy/" itemprop="url">JavaScript深拷贝</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-01T17:26:00+08:00">
                2019-02-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>第一步:简单实现</p>
<blockquote>
<p>深拷贝可以分为2步,浅拷贝 + 递归  ,浅拷贝时判断属性值是否是对象,如果是对象就进行递归操作,两个一结合就实现了深拷贝。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fucntion cloneShadow()&#123;</span><br><span class="line">     <span class="keyword">var</span>  target = &#123;&#125;;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">         <span class="keyword">if</span>(<span class="built_in">Object</span>.prorotype.hasOwnProperty.call(source,key))&#123;</span><br><span class="line">              target[key] = source[key];</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>//测试用例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a  = &#123;</span><br><span class="line">   name:<span class="string">'muyiy'</span>,</span><br><span class="line">   book:&#123;</span><br><span class="line">       title:<span class="string">"You Don't Know JS"</span>,</span><br><span class="line">       price:<span class="string">'45'</span></span><br><span class="line">   &#125;,</span><br><span class="line">   a1:<span class="literal">undefined</span>,</span><br><span class="line">   a2:<span class="literal">null</span>,</span><br><span class="line">   a3:<span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = cloneShadow(a);</span><br><span class="line">a.name = <span class="string">"高级前端进阶"</span>;</span><br><span class="line">a.book.price = <span class="string">'55'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//   name: 'muyiy',</span></span><br><span class="line"><span class="comment">//   book: &#123; title: 'You Don\'t Know JS', price: '55' &#125;,</span></span><br><span class="line"><span class="comment">//   a1: undefined,</span></span><br><span class="line"><span class="comment">//   a2: null,</span></span><br><span class="line"><span class="comment">//   a3: 123</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>上面代码是浅拷贝的实现,只要稍微改动下,加上是否是对象的判断并且在相应的位置使用递归就可以实现简单的浅拷贝</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cloneDeep1</span>(<span class="params">source</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">var</span> target = &#123;&#125;;</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">       <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.hasOwnProperty.call(source,key))&#123;</span><br><span class="line">         <span class="keyword">if</span>(<span class="keyword">typeof</span> source[<span class="string">'key'</span>] === <span class="string">"object"</span>) &#123;</span><br><span class="line">                target[key] = cloneDeep1(source[key]);  <span class="comment">//注意这里 递归</span></span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                target[key] = source[key];</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用上面的测试一下</span></span><br><span class="line"><span class="keyword">var</span> b = cloneDeep1(a);</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   name: 'muyiy',</span></span><br><span class="line"><span class="comment">//   book: &#123; title: 'You Don\'t Know JS', price: '45' &#125;,</span></span><br><span class="line"><span class="comment">//   a1: undefined,</span></span><br><span class="line"><span class="comment">//   a2: &#123;&#125;,</span></span><br><span class="line"><span class="comment">//   a3: 123</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<p>一个简单的浅拷贝已经实现 但是还存在许多问题</p>
<ul>
<li>1、没有对传入参数进行校验，传入 null 时应该返回 null 而不是 {}</li>
<li>2、对于对象的判断逻辑不严谨，因为 typeof null === ‘object’</li>
<li>3、没有考虑数组的兼容</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/31/for/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="vanisher">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/19483268?s=400&u=97869a443baab2820618a8a575cee677b80849c7&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vanisher's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/31/for/" itemprop="url">for of 与 for in 遍历区别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-31T13:09:46+08:00">
                2019-01-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//遍历数组</span></span><br><span class="line"> <span class="keyword">var</span>  myarr  = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"> <span class="built_in">Array</span>.prototype.name = <span class="function"><span class="keyword">function</span>(<span class="params">first_argument</span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="keyword">this</span>.length)</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"> myarr.name = <span class="string">'数组'</span></span><br><span class="line">     <span class="comment">//使用for in会遍历数组所有的可枚举属性，包括原型</span></span><br><span class="line">     <span class="comment">//所以for in更适合遍历对象，不要使用for in遍历数组。</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// for(var index in myarr)&#123;</span></span><br><span class="line">   <span class="comment">// 	console.log(myarr[index])</span></span><br><span class="line">   <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//记住，for in遍历的是数组的索引（即键名），而for of遍历的是数组元素值。</span></span><br><span class="line">   <span class="comment">//for of遍历的只是数组内的元素，而不包括数组的原型属性method和索引name</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// for(var value of myarr) &#123;</span></span><br><span class="line">   <span class="comment">// 	console.log(value)</span></span><br><span class="line">   <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//遍历对象</span></span><br><span class="line">    <span class="built_in">Object</span>.prototype.method = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> myobj = &#123;</span><br><span class="line">        a:<span class="number">1</span>,</span><br><span class="line">        b:<span class="number">2</span>,</span><br><span class="line">        c:<span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> myobj) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(key)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//同样可以通过ES5的Object.keys(myObject)获取对象的实例属性组成的数组，不包括原型方法和属性</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> keyArr = <span class="built_in">Object</span>.keys(myobj)</span><br><span class="line">    <span class="built_in">console</span>.log(keyArr)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/31/d3/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="vanisher">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/19483268?s=400&u=97869a443baab2820618a8a575cee677b80849c7&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vanisher's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/31/d3/" itemprop="url">D3 从入门到放弃</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-31T12:46:37+08:00">
                2019-01-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<blockquote>
<p>D3.js基础<br>1.了解SVG图做图<br>2.学习D3.js的语法<br>3.学习D3.js的编程思路</p>
</blockquote>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//直接选择 -&gt;并设置属性</span></span><br><span class="line"> d3.select(<span class="string">"body"</span>).style(<span class="string">"background-color"</span>,balck)</span><br><span class="line"></span><br><span class="line"><span class="comment">//选择 -&gt; 动态设置属性</span></span><br><span class="line">  d3.selectAll(<span class="string">"p"</span>).style(<span class="string">"color"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">"hsl("</span> + <span class="built_in">Math</span>.randow() * <span class="number">360</span> + <span class="string">",100%,50%)"</span>;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//选择 -&gt; 绑定数据 -&gt; 动态设置属性</span></span><br><span class="line">d3.selectAll(<span class="string">"p"</span>)</span><br><span class="line">  .data([<span class="number">4</span>,<span class="number">8</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">24</span>,<span class="number">45</span>])</span><br><span class="line">     .style(<span class="string">"font-size"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d + <span class="string">'px'</span>; &#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>理解 Update ， Enter 和 Exit思路</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//Update...</span></span><br><span class="line"> <span class="keyword">var</span> p = d3.select(<span class="string">"body"</span>) <span class="comment">//直接把数据绑定到Dom并输出,数组元素个数与p节点的个数一致就更新文本,如果不一致,就只更新现有的p节点文本,多余的数据会被保存起来,看下面会用到</span></span><br><span class="line">            .selectAll(<span class="string">"p"</span>)</span><br><span class="line">            .data([<span class="number">4</span>,<span class="number">8</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">23</span>,<span class="number">42</span>])</span><br><span class="line">               .text(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d; &#125;);</span><br><span class="line"> <span class="comment">//Enter...[常用]    </span></span><br><span class="line"> p.enter().append(<span class="string">"p"</span>)  <span class="comment">//如果不一致,数组元素个数比p节点多,就插入p节点补足并相应更新文本</span></span><br><span class="line">       .text(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;<span class="keyword">return</span> d;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Exit...[常用]</span></span><br><span class="line">p.exit().remove();  <span class="comment">//如果不一致,数组元素比p节点少,就删除多余的p节点</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>动画基本写法</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">"circle"</span>).transition() <span class="comment">//定义动画</span></span><br><span class="line">     .duration(<span class="number">750</span>) <span class="comment">//动画持续时间</span></span><br><span class="line">     .delay(<span class="function"><span class="keyword">function</span>(<span class="params">d,i</span>) </span>&#123; <span class="keyword">return</span> i * <span class="number">10</span> ;&#125;)  <span class="comment">//元素动画要延长多少时间开始</span></span><br><span class="line">     .attr(<span class="string">"r"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(d * scale);&#125;) <span class="comment">//设置最后效果</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars2.githubusercontent.com/u/19483268?s=400&u=97869a443baab2820618a8a575cee677b80849c7&v=4" alt="vanisher">
            
              <p class="site-author-name" itemprop="name">vanisher</p>
              <p class="site-description motion-element" itemprop="description">需要努力去超越的唯有昨日的自己</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Van-MR" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/u/3170682882" target="_blank" title="微博">
                      
                        <i class="fa fa-fw fa-weibo"></i>微博</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">vanisher</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
